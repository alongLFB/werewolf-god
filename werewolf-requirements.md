# 狼人杀法官助手 - 需求文档

## 项目概述

### 项目目标
开发一个基于 Next.js 的网页应用，帮助狼人杀新手玩家担任法官角色，通过标准化的流程引导和自动记录功能，让任何人都能轻松主持游戏。

### 目标用户
- 主要用户：没有法官经验的新手玩家
- 次要用户：希望规范化管理游戏流程的资深法官

### 核心价值
- 标准化流程引导，降低法官门槛
- 自动记录游戏信息，避免遗漏
- 智能提醒和判定，减少规则错误

## 游戏板子配置

### 支持的游戏模式

#### 1. 9人标准局
- **配置**：3狼3民3神
- **角色组成**：
  - 狼人 × 3
  - 村民 × 3
  - 预言家 × 1
  - 女巫 × 1
  - 猎人 × 1

#### 2. 10人局
- **配置**：3狼4民3神
  - 狼人 × 3
  - 村民 × 4
  - 预言家、女巫、猎人 各1

#### 3. 12人狼王守卫局
- **配置**：4狼4民4神
- **角色组成**：
  - 狼王 × 1
  - 狼人 × 3
  - 村民 × 4
  - 预言家 × 1
  - 女巫 × 1
  - 猎人 × 1
  - 守卫 × 1

#### 4. 12人白狼王骑士局
- **配置**：4狼4民4神
- **角色组成**：
  - 白狼王 × 1
  - 狼人 × 3
  - 村民 × 4
  - 预言家 × 1
  - 女巫 × 1
  - 猎人 × 1
  - 骑士 × 1

## 角色能力详解

### 狼人阵营

#### 普通狼人
- 每晚与同伴统一意见击杀一名玩家
- 知道同伴身份

#### 狼王（黑狼王）
- 拥有普通狼人的所有能力
- **特殊技能**：被投票放逐时可以开枪带走一名玩家
- **限制**：被女巫毒杀时不能开枪

#### 白狼王
- 拥有普通狼人的所有能力
- **特殊技能**：白天发言阶段可以自爆，并带走一名玩家
- **触发时机**：轮到自己发言时
- **效果**：自爆后直接进入黑夜，被带走玩家无遗言

### 神职阵营

#### 预言家
- 每晚可以查验一名玩家的身份
- 得知该玩家是"好人"或"狼人"

#### 女巫
- 拥有一瓶解药和一瓶毒药（整局游戏各一次）
- 解药：可以救活当晚被狼人击杀的玩家
- 毒药：可以毒杀一名玩家
- **限制**：首夜不能自救

#### 猎人
- **特殊技能**：出局时可以开枪带走一名玩家
- **触发条件**：被狼人击杀或被投票放逐
- **限制**：被女巫毒杀时不能开枪

#### 守卫
- 每晚可以守护一名玩家（包括自己）
- 被守护的玩家当晚不会被狼人击杀
- **限制**：不能连续两晚守护同一名玩家
- **特殊规则**：首夜参与行动

#### 骑士
- **特殊技能**：白天可以发动决斗
- 指定一名玩家进行决斗
- 若对方是狼人，则对方出局
- 若对方是好人，则骑士出局
- 每局游戏只能使用一次

### 村民阵营

#### 普通村民
- 没有特殊技能
- 通过发言和投票参与游戏

## 游戏规则设定

### 固定规则（不可配置）
1. 女巫首夜不能自救
2. 守卫不能连续两晚守护同一人
3. 守卫可以守护自己
4. 首夜有守卫参与
5. 狼王/猎人被女巫毒杀不能开枪
6. 同守同救（守卫守护和女巫解药同时作用）玩家死亡

### 技能触发条件表

| 角色 | 被投票放逐 | 被狼人击杀 | 被女巫毒杀 | 被白狼王带走 | 被骑士决斗 |
|------|-----------|-----------|-----------|-------------|-----------|
| 狼王 | ✅ 可开枪 | ❌ 不可 | ❌ 不可 | ❌ 不可 | ❌ 不可 |
| 猎人 | ✅ 可开枪 | ✅ 可开枪 | ❌ 不可 | ✅ 可开枪 | ✅ 可开枪 |

### 开枪机制详细说明

#### 猎人开枪状态判定
1. **夜晚告知环节**：
   - 每个夜晚都需要叫醒猎人
   - 告知猎人当前的开枪状态
   - 如果猎人当晚会被毒杀，提前告知不能开枪
   - 其他情况（包括存活状态）告知可以开枪

2. **开枪状态判定逻辑**：
   - **不能开枪**：将被女巫毒杀（当晚女巫使用毒药毒杀猎人）
   - **可以开枪**：
     - 正常存活状态
     - 将被狼人击杀
     - 将被投票放逐
     - 将被白狼王带走
     - 将被骑士决斗

#### 猎人开枪时机
1. **夜晚被狼刀**：天亮后立即触发，在遗言前开枪
2. **被投票放逐**：投票结果宣布后立即触发
3. **被白狼王带走**：白狼王自爆时立即触发
4. **被骑士决斗**：决斗结果宣布后立即触发
5. **被女巫毒杀**：不能开枪，直接死亡

#### 狼王开枪时机
1. **被投票放逐**：投票结果宣布后立即触发
2. **其他死亡方式**：不能开枪

#### 开枪流程
1. 法官宣布玩家倒下
2. 要求玩家亮明身份牌
3. 确认是否有开枪资格（非毒杀）
4. 玩家选择开枪目标（可以选择不开）
5. 被带走玩家无遗言直接出局

## 功能模块设计

### 1. 游戏配置模块

#### 功能需求
- 选择游戏模式（预设板子或自定义）
- 设置玩家数量和座位号
- 随机分配角色或手动指定
- 保存常用配置模板

#### 界面设计
- 预设板子快速选择卡片
- 自定义角色拖拽配置
- 玩家座位可视化布局

### 2. 流程引导系统

#### 夜晚流程（执行顺序）

##### 2.1 守卫环节
```
台词提示：
"守卫请睁眼"
"请选择你要守护的玩家"
[系统提示：上轮守护了X号，本轮不能再守护]
"守卫请闭眼"
```

##### 2.2 狼人环节
```
台词提示：
"狼人请睁眼"
"请互相确认身份"
"请统一意见，选择要击杀的目标"
[系统标注狼王/白狼王身份]
"狼人请闭眼"
```

##### 2.3 预言家环节
```
台词提示：
"预言家请睁眼"
"你要查验的玩家是几号？"
[系统显示查验结果：好人/狼人]
"预言家请闭眼"
```

##### 2.4 女巫环节
```
台词提示：
"女巫请睁眼"
"今晚X号玩家倒下了"
"你有一瓶解药，要使用吗？"
[首夜自己倒下时提示：首夜不能自救]
"你有一瓶毒药，要使用吗？"
"女巫请闭眼"
```

##### 2.5 猎人环节
```
台词提示：
"猎人请睁眼"
"请猎人确认自己的开枪状态"
[法官手势或系统显示：
  - 摇头/显示❌：不能开枪（被女巫毒杀）
  - 点头/显示✅：可以开枪（其他死亡方式）]
"猎人请闭眼"

注意：此环节仅告知状态，不进行开枪操作
```

#### 白天流程

##### 2.5 天亮环节
- 自动判定死亡情况（考虑守护、解药、毒药效果）
- 宣布平安夜或死亡玩家
- 死亡玩家发表遗言（被白狼王带走除外）
- **猎人开枪判定**（如果猎人死亡）

###### 猎人开枪环节
```
触发条件：猎人被狼刀或被投票放逐
台词提示：
"猎人倒下了，请猎人亮明身份牌"
"你可以选择开枪带走一名玩家，或者不开枪"
[系统提示：如果是被毒死则不能开枪]
"猎人选择带走X号玩家"
```

##### 2.6 发言讨论
- 支持警长竞选流程
- 记录发言顺序
- 白狼王自爆触发点
- 骑士决斗触发点

##### 2.7 投票放逐
- 记录投票情况
- 统计票数
- 平票处理（警长1.5票）
- 宣布放逐结果
- **触发狼王/猎人开枪判定**

###### 狼王开枪环节
```
触发条件：狼王被投票放逐
台词提示：
"X号玩家被放逐，请亮明身份牌"
"狼王倒下，可以开枪带走一名玩家"
"狼王选择带走X号玩家"
```

###### 投票后猎人开枪环节
```
触发条件：猎人被投票放逐
台词提示：
"X号玩家被放逐，请亮明身份牌"
"猎人倒下，可以开枪带走一名玩家"
"猎人选择带走X号玩家"
```

### 3. 信息记录系统

#### 需要记录的信息

##### 游戏配置信息
- 玩家座位与角色对应关系
- 游戏规则设置
- 初始状态

##### 夜晚行动记录
- 守卫守护目标（需记录历史防止连守）
- 狼人击杀目标
- 预言家查验目标及结果
- 女巫用药情况（解药/毒药目标）
- **猎人开枪状态告知**（每晚记录是否能开枪）

##### 白天行动记录
- 发言顺序
- 重要发言标记
- 投票情况（谁投了谁）
- 技能使用（白狼王自爆、骑士决斗）
- **开枪记录**（猎人/狼王开枪目标及时机）

##### 玩家状态追踪
- 存活/死亡状态
- 死亡原因（刀杀/毒杀/放逐/枪杀/决斗）
- 死亡时间（第几天/夜）
- 技能使用状态（药水是否已用、决斗是否已用）
- **开枪状态**（猎人/狼王是否已开枪、是否能开枪）

### 4. 辅助功能

#### 4.1 历史回顾
- 查看任意回合的详细记录
- 搜索特定玩家的行动历史
- 导出游戏记录

#### 4.2 智能判定
- 自动判断游戏结束条件
- 胜负判定（屠边/屠城）
- 规则冲突提醒
- 特殊情况处理提示

#### 4.3 笔记系统
- 法官私人笔记
- 玩家发言要点记录
- 身份推理标记

#### 4.4 快捷操作
- 一键进入下一阶段
- 快速标记玩家状态
- 撤销/重做功能
- 紧急暂停功能

### 5. 进阶功能

#### 5.1 语音播报（TTS）
- 自动朗读法官台词
- 背景音效（可选）
- 音量和语速调节

#### 5.2 游戏复盘
- 生成游戏总结报告
- 数据统计（发言时长、投票分析等）
- 精彩时刻标记
- MVP评选建议

#### 5.3 分享功能
- 生成游戏报告图片
- 分享链接给玩家查看
- 支持导出PDF

#### 5.4 教学模式
- 新手引导教程
- 规则详解
- 常见错误案例
- 法官技巧提示

## 技术实现方案

### 技术栈
- **框架**：Next.js 15.5.0 (App Router)
- **语言**：TypeScript 5.X
- **样式**：Tailwind CSS
- **状态管理**：Zustand 或 Redux Toolkit
- **数据持久化**：localStorage + IndexedDB + Supabase
- **UI组件**：shadcn 2.10.0
- **动画**：Framer Motion 12.23.12

### 数据结构设计

```typescript
// 游戏配置
interface GameConfig {
  mode: '9人局' | '10人局' | '12人狼王守卫' | '12人白狼王骑士' | '自定义'
  playerCount: number
  roles: Role[]
  rules: GameRules
}

// 角色定义
interface Role {
  id: string
  type: RoleType
  name: string
  camp: 'werewolf' | 'villager' | 'gods'
  abilities: Ability[]
  team: 'werewolf' | 'good'
}

// 玩家状态
interface Player {
  seatNumber: number
  name?: string
  role: Role
  isAlive: boolean
  deathReason?: 'knife' | 'poison' | 'vote' | 'shoot' | 'duel' | 'bomb' // 添加bomb(自爆带走)
  deathRound?: number
  deathPhase?: 'night' | 'day'
  protectedLastNight?: boolean
  canShoot?: boolean // 是否能开枪（猎人/狼王）
  hasShot?: boolean  // 是否已开枪
  hasUsedAbility?: {
    poison?: boolean
    antidote?: boolean
    duel?: boolean
    shoot?: boolean
    bomb?: boolean // 白狼王自爆
  }
}

// 游戏状态
interface GameState {
  config: GameConfig
  phase: 'night' | 'day'
  round: number
  currentStep: GameStep
  players: Player[]
  history: ActionRecord[]
  votes: VoteRecord[]
  winner?: 'werewolf' | 'good' | null
}

// 行动记录
interface ActionRecord {
  round: number
  phase: 'night' | 'day'
  actor: number // 座位号
  action: 'guard' | 'kill' | 'check' | 'poison' | 'antidote' | 'shoot' | 'bomb' | 'duel' | 'vote' | 'hunterStatus'
  target?: number
  result?: any // 查验结果、开枪状态等
  timestamp: Date
}

// 夜晚流程状态
interface NightPhaseState {
  guardTarget?: number
  wolfKillTarget?: number
  seerCheckTarget?: number
  seerCheckResult?: 'good' | 'werewolf'
  witchAntidoteTarget?: number
  witchPoisonTarget?: number
  hunterCanShoot: boolean // 猎人开枪状态
}
```

### 页面路由设计

```
/                     # 首页
/game/new            # 新建游戏
/game/config         # 游戏配置
/game/[id]           # 游戏进行
/game/[id]/history   # 历史记录
/game/[id]/report    # 游戏报告
/tutorial            # 教程
/templates           # 配置模板
```

## UI/UX 设计要求

### 设计原则
1. **移动优先**：优先适配手机端，支持单手操作
2. **清晰明了**：信息层级分明，状态一目了然
3. **防误操作**：重要操作需要确认，支持撤销
4. **视觉反馈**：操作有即时反馈，状态变化有动画

### 核心界面设计

#### 游戏进行页面布局
```
┌─────────────────────────┐
│      当前阶段指示器        │
├─────────────────────────┤
│                         │
│      台词提示区域         │
│                         │
├─────────────────────────┤
│      操作按钮区域         │
├─────────────────────────┤
│      玩家列表            │
│   [1] [2] [3] [4]       │
│   [5] [6] [7] [8]       │
│                         │
└─────────────────────────┘
```

#### 玩家信息卡片
```
┌──────────────┐
│ 3号  张三     │
│ 🧙 预言家     │
│ ✅ 存活       │
│ 查验: 5✅ 7❌  │
└──────────────┘
```

### 交互设计

#### 操作确认机制
所有关键操作需要二次确认：
- 击杀/守护/查验目标选择
- 用药确认
- 开枪/自爆/决斗目标
- 投票结果确认

#### 错误预防
- 不可选择的目标置灰
- 违规操作实时提示
- 操作历史可追溯

## 项目实施计划

### 第一阶段：核心功能（MVP）
1. 基础9人局游戏流程
2. 角色分配与记录
3. 夜晚/白天基本流程
4. 简单的胜负判定

### 第二阶段：完善功能
1. 支持所有预设板子
2. 特殊角色技能实现
3. 历史记录与回顾
4. 数据持久化

### 第三阶段：进阶功能
1. 语音播报功能
2. 游戏复盘系统
3. 分享功能
4. 教学模式

### 第四阶段：优化迭代
1. 性能优化
2. 用户体验优化
3. 更多板子支持
4. 社区功能

## 测试要求

### 功能测试
- 各角色技能正确触发
- 游戏流程完整性
- 胜负判定准确性
- 数据记录准确性

### 兼容性测试
- 不同屏幕尺寸适配
- 不同浏览器兼容性
- 离线功能可用性

### 用户测试
- 新手引导有效性
- 操作流畅度
- 错误恢复能力

## 附录

### 常见问题处理

1. **同守同救问题**
   - 当守卫守护和女巫解药同时作用于同一玩家时，该玩家死亡

2. **平票处理**
   - 有警长时，警长票算1.5票
   - 无警长平票，无人出局

3. **技能冲突处理**
   - 明确各技能优先级
   - 提供清晰的规则说明

4. **开枪判定处理**
   - 系统需要自动判断死亡原因
   - 被毒杀的猎人/狼王自动禁用开枪
   - 开枪选择界面需要排除已死亡玩家
   - 连环开枪处理（猎人开枪打中猎人/狼王）
   - **猎人夜晚状态告知**：系统需要在女巫用药后自动判断并显示猎人开枪状态

### 扩展功能考虑

1. **更多角色支持**
   - 丘比特、盗贼、混血儿等
   - 自定义角色创建

2. **竞技功能**
   - 积分系统
   - 排行榜
   - 成就系统

3. **AI辅助**
   - 智能发言分析
   - 身份推理建议
   - 最优策略提示

---

*文档版本：1.0.0*  
*最后更新：2025年*